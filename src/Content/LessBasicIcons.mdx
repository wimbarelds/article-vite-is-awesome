## Less Basic Icons

At this point I was quite pleased with what I'd made. I figured I'd run a lighthouse test so it
could tell me what a good job I'd done...

Indeed, I achieved 90+ scores across the board. However, Lighthouse still offered suggestions for
further improvement. One key suggestion was to address "render blocking requests," which are HTTP
requests that prevent your page from being rendered until loaded.

Our "awesome" icon plugin was no longer good enough. It first triggers a request to load the CSS
file, and then a subsequent request to load the font itself. How can we fix this?

Well...

```ts
type Options = { inline?: 'none' | 'css' | 'full' };
export async function vitePluginMuiIcons(names: string[], options: Options = {}): Promise<Plugin> {
  const { inline = 'css' } = options;

  const namesStr = names.toSorted().join(',');
  const cssUrl = `https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,-25&&icon_names=${namesStr}`;

  if (inline === 'none') {
    return {
      name: 'mui-iconfont',
      transformIndexHtml: () => [{ tag: 'link', attrs: { rel: 'stylesheet', href: cssUrl } }],
    };
  }

  // Download the CSS
  let css = await fetch(cssUrl).then((res) => res.text());
  if (inline === 'css') {
    // This option only inlines the CSS, the font-file still need to be downloaded
    return {
      name: 'mui-iconfont',
      transformIndexHtml: () => [{ tag: 'style', attrs: { type: 'text/css' }, children: css }],
    };
  }

  // replace `url(URL)` with `url(data:font/woff2;base64,...)`
  const urlRegex = /url\(([^)]+)\)/;
  const fontUrl = css.match(urlRegex)?.[1];
  if (fontUrl) {
    const base64 = await fetch(fontUrl)
      .then((res) => res.arrayBuffer())
      .then((buffer) => Buffer.from(buffer).toString('base64'));

    css = css.replace(urlRegex, `url(data:font/woff2;base64,${base64})`);
  }

  return {
    name: 'mui-iconfont',
    transformIndexHtml: () => [{ tag: 'style', attrs: { type: 'text/css' }, children: css }],
  };
}
```

This code is still quite readable! We download the CSS file, then the font binary, convert it to
Base64, and finally, inline the entire thing directly into `index.html`. This resulted in a
Lighthouse performance score of **100**. While a React workshop didn't strictly need such a high
score, it just goes to show: Vite is awesome!
